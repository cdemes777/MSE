# Koppelung der BCs durch Events
Die beiden Bounded Contexts sollen nicht direkt voneinander abhängen, sondern über Domain Events interagieren.
Das Usermanagement publiziert Ereignisse, die das Feedbackmanagement konsumiert, ohne die interne Logik des Usermanagements zu kennen.

## Prinzip der losen Kopplung

Jeder Kontext definiert seine eigenen Aggregate und Services.

Events enthalten nur IDs + relevante Daten (keine vollständigen Objekte des anderen Kontexts).

Kommunikation über Event-Bus oder Event-Publisher (z.B. Spring ApplicationEvent, Kafka, RabbitMQ).

Dadurch kann Feedbackmanagement unabhängig vom Usermanagement evolvieren, und Änderungen am Userkontext brechen Feedbacklogik nicht.

## 1. Events vom Usermanagement → Feedbackmanagement

Diese Events informieren andere Kontexte (z.B. Feedbackmanagement) über relevante Änderungen bei Benutzern:

| Event                            | Zweck / Beschreibung                                                                                                                              |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UserRegistered**               | Ein neuer Benutzer wurde registriert. Feedbackmanagement kann optional initiale Daten vorbereiten oder Limits prüfen.                             |
| **UserAuthenticated**            | Ein Benutzer hat sich erfolgreich angemeldet. Optional, wenn Feedback-Interaktionen z. B. nur für angemeldete Benutzer erlaubt sind.              |
| **UserStatusChanged** (optional) | Benutzer wurde deaktiviert/reaktiviert. Feedbackmanagement kann darauf reagieren, z. B. bestehende Feedbacks von deaktivierten Benutzern sperren. |
| **UserRoleChanged** (optional)   | Rolle des Benutzers geändert. Feedbackmanagement kann die Sichtbarkeit oder Rechte überprüfen (z. B. Admin vs Bürger).                            |

> Feedbackmanagement nutzt nur Benutzer-ID aus dem Event, nicht das komplette User-Objekt.

## 2. Events vom Feedbackmanagement → Usermanagement (optional)

In den meisten Fällen ist Feedbackmanagement autark, aber wenn Usermanagement z.B. Benachrichtigungen an Benutzer verschicken will, könnten diese Events relevant sein:

| Event                 | Zweck / Beschreibung                                                                                                 |
| --------------------- | -------------------------------------------------------------------------------------------------------------------- |
| **FeedbackCreated**   | Ein neues Feedback wurde erstellt. Usermanagement kann z. B. Statistik oder Benachrichtigung auslösen.               |
| **FeedbackPublished** | Feedback wurde veröffentlicht. Usermanagement kann Aktivitäten protokollieren oder Push-Benachrichtigungen auslösen. |
| **FeedbackWithdrawn** | Feedback wurde zurückgenommen. Usermanagement kann z. B. Status von Benachrichtigungen anpassen.                     |
| **CommentAdded**      | Ein Kommentar zu Feedback wurde hinzugefügt. Optional für Benachrichtigung oder Monitoring.                          |

Domain Events sind das Kommunikationsmittel zwischen Bounded Contexts – aber die Kommunikation erfolgt locker und asynchron, nicht durch direkte Aufrufe oder direkte Änderung der Aggregate eines anderen BC.


| Flow                                | Beschreibung                                                                                                                                              |
| ----------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Usermanagement → Feedbackmanagement | Events wie `UserRegistered`, `UserStatusChanged` feuern. Feedbackmanagement reagiert eigenständig, erzeugt evtl. eigene Events (`FeedbackStatusChanged`). |
| Feedbackmanagement → Usermanagement | Events wie `FeedbackCreated` feuern. Usermanagement kann Benachrichtigungen oder Statistiken erzeugen, ggf. eigene Events.                                |


**Usermanagement → Feedbackmanagement**

- Event: UserStatusChanged
- Feedbackmanagement entscheidet: „Alle Feedbacks des Users auf INACTIVE setzen“ → optional FeedbackStatusChanged Event erzeugen

**Feedbackmanagement → Usermanagement**

- Event: FeedbackCreated
- Usermanagement entscheidet: „Benachrichtigung an den User senden“ → optional NotificationSent Event erzeugen